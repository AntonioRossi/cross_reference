<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">

    <style>
    * { 
      -moz-box-sizing:border-box; 
      -webkit-box-sizing:border-box; 
       box-sizing:border-box; 
    }
    
    h2 {
      
      margin-top:0;
      margin-bottom: 8px;
      color: black;
    }
    
    .main-wrapper {
    position:relative;
    width:100%;
    /*height: 1024px;*/
    margin:0 auto;
    }
    
    select {
    
    width: 100%;
    
    -moz-appearance: none;
    -webkit-appearance: none;
    background: url(https://ssl.gstatic.com/ui/v1/disclosure/grey-disclosure-arrow-up-down.png), white;
    background-position: 95% 50%;
    background-repeat: no-repeat;
    border: 1px solid #918F92;
    -moz-border-radius: 2px;
    -webkit-border-radius: 2px;
    border-radius: 0px;
    color: #333;
    cursor: default;
    font-family: arial, sans-serif;
    font-size: 24px;
    font-weight: bold;
    height: 70px;
    margin: 0;
    min-width: 72px;
    outline: 0;
    padding: 7px 19px 7px 10px;
    text-align: left;
    text-indent: .01px;
    text-overflow: ellipsis;
    text-overflow: '';
    white-space: nowrap;
}
    
    .details {
      width: 100%;
    }
    
    .labels, .references {
    color: black;
    padding: 24px;
    }
    
    .labels {
    background: #abbab7;
    }
    
    .references {
      background: #e1cdc2;
    }
    
    .xrow {
      height: 50px;
    }
    
    .xname, .style {
      float:left;
      width: 26%;
      padding-top: 5px;
      font-weight: bold;
    }
    
    .style {
      padding-top: 12px;
    }
    
    .xcontent {
      float:left
    }
    
    .style-button {
     float:left;
     width: 50px;
     height: 30px;
     background:white;
     cursor: default;
     margin: 4px 8px 4px 0;
     padding: 4px;
     padding-top: 6px;
     text-align: center;
     box-shadow: 1px 1px 1px 1px rgba(0,0,0,0.1);
    }
    
    .st-selected {
      background: indianred;
      color: white;
    }
    
    #lab_code, #ref_code {
      width:45px;
      height:26px;
      padding-top: 5px;
    }
    
    #lab_text, #ref_text {
      width: 120px;
      height:26px;
      padding-left: 5px;
    }
    
    .shadedtext1, .shadedtext2 {
      float: left;
      color: rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .shadedtext1 {
      white-space: nowrap;
      margin-right: 5px;
    }
    .shadedtext2 {
      margin-left: 1px;
    }
 
    .result-row {
      width: 100%;
      height: 70px;
      margin-top: 30px;
      background: white;
      border-radius: 5px;
      border: 1px solid gray;
      box-shadow: inset 1px 1px 1px 1px rgba(0,0,0,0.2);
    }
    
    .line1, .line2 {
      height: 20px;
      width: 500px;
      overflow: hidden;
    }
  
    .results-internal {
      margin: auto;
      height: 60px;
      overflow: hidden;
      width: 85%;
      padding-top: 15px;
    }
    
    .hash {
      float: left;
      width:20px;
      height:26px;
      padding:4px;
      padding-right: 0px;
     -moz-box-sizing:border-box;
     -webkit-box-sizing:border-box;
      box-sizing:border-box;
    }
    
    .hash-input {
      float:left;
    }
    
    .actions {
      width: 100%;
    }
    
    .selection {
    height: 70px;
    }
    
    
    .selection .xrow {
      width: 100%;
      height: 80px;
      margin-top: 20px;
      padding: 22px 20px 20px 20px;
      background: #d57676;
    }
    
    .button-row1, .button-row2 {
      height: 55px;
      position: relative;
    }
    
    .button-row1 {
      background: #e49767;
    }
    
    #save {
      position: absolute;
      left:25px;
      top:15px;
    }
    
    #cancel {
      position: absolute;
      right:25px;
      top:15px;
    }
    
    #save_defaults {
      position: absolute;
      left:25px;
      top:12px;
    }
    
    #restore_defaults {
      position: absolute;
      right:25px;
      top:12px;
    }

    </style>
  </head>
  <body>
  <div class="main-wrapper">
    <article class="selection">
      <select id="name" onchange="selectName();">
      </select>
    </article> 
    <article class="details">
      <div class="labels">
        <div class="xrow">
        <h2>Labels</h2>
        </div>
        <div class="xrow">
          <div class="xname">
            Code
          </div>
          <div class="xcontent">
            <div class="hash-input">
              <!--<input type="text" id="lab_code" value="" maxlength="5"/>-->
              <div id="lab_code">
              </div>
            </div>
          </div>
        </div>
        <div class="xrow">
          <div class="xname">
            Text
          </div>
          <div class="xcontent">
            <input type="text" id="lab_text"/>
          </div>
        </div>
        <div class="xrow">
          <div class="style">
            Style
          </div>
          <div class="xcontent">
            <div id="lab_bold" class="style-button" title="false">
              Bold
            </div>
            <div id="lab_ital" class="style-button" title="false">
              Italic
            </div>
            <div id="lab_unde" class="style-button" title="false">
              ULine
            </div>
          </div>
        </div>
        <div class="result-row">
          <div class="results-internal">
            <div class = "line1">
              <div class="shadedtext1">
                Rendered
              </div>
              <div class="xcontent" id="lab_result">
                figure 1
              </div>
              <div class="shadedtext2">
                . Early human migration route out of Africa
              </div>
            </div>
            <div class= "line2">
              <div class="xcontent" id="lab_result2">
                Figure 1
              </div>
              <div class="shadedtext2">
                . Early human migration route out of Africa
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="references">
        <div class="xrow">
        <h2>References</h2>
        </div>
        <div class="xrow">
          <div class="xname">
            Code
          </div>
          <div class="xcontent" id="ref_code">
            <em>#</em>
          </div>
        </div>
        <div class="xrow">
          <div class="xname">
            Text
          </div>
          <div class="xcontent">
            <input type="text" id="ref_text"/>
          </div>
        </div>
        <div class="xrow">
          <div class="style">
            Style
          </div>
          <div class="xcontent">
            <div id="ref_bold" class="style-button" title="false">
              Bold
            </div>
            <div id="ref_ital" class="style-button" title="false">
              Italic
            </div>
            <div id="ref_unde" class="style-button" title="false">
              ULine
            </div>
          </div>
        </div>
        <div class="result-row">
          <div class="results-internal">
            <div class = "line1">
              <div class="shadedtext1">
                the line in
              </div>
              <div class="xcontent" id="ref_result">
                figure 1
              </div>
              <div class="shadedtext2">
                &nbsp;represents the path of human
              </div>
            </div>
            <div class= "line2">
              <div class="shadedtext1">
                to Ethiopia.
              </div>
              <div class="xcontent" id="ref_result2">
                Figure 1
              </div>
              <div class="shadedtext2">
                &nbsp;is accurate to within 100 miles
              </div>
            </div>
          </div>
        </div>
      </div>
    </article>
    <article class="actions">
      <div class="button-row1">
        <button id="save_defaults" onclick="storeDefault()">
          Save defaults
        </button>
        <button id="restore_defaults" onclick="google.script.run.withSuccessHandler(restoreDefault).restoreDefault()">
          Restore defaults
        </button>
      </div>
      <div class="button-row2">
        <button id="save" onclick="saveProperties()" class="blue">
          Save and apply
        </button>
        <button id="cancel" onclick="google.script.host.close()">
          Cancel
        </button>
      </div>
    </article>
  </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script>
    
    var styles = {};
    var temp_settings = {};
    
    $(function() {
            google.script.run
                .withSuccessHandler(initialiseSidebar)
                .getSettings();
        });

    function initialiseSidebar(settings) {
      var names = [];
      for (var i in settings) {
        var set_array = settings[i].split('_');
        var name = set_array[1];
        names.push(name);
        temp_settings[name] = set_array;
      }
      
      var sorted_names = names.sort()
      
      for (var i in sorted_names) {
        var final_name = sorted_names[i]
        var option = document.createElement("option");
        option.text = final_name;
        document.getElementById("name").add(option);
      }
      $("#name").data('val', sorted_names[0])
      updateSidebar(sorted_names[0])
    }
 
    function updateSidebar(name) {

      var csets = temp_settings[name];
      var clab_code = csets[0];
      var clab_text = csets[2];
      var clab_bold = csets[3];
      var clab_ital = csets[4];
      var clab_unde = csets[5];
      var cref_text = csets[6];
      var cref_bold = csets[7];
      var cref_ital = csets[8];
      var cref_unde = csets[9];
      
      document.getElementById("lab_code").innerHTML = "#" + clab_code;
      document.getElementById("lab_text").value = clab_text;
      document.getElementById("ref_code").value = clab_code.substr(0,3);
      document.getElementById("ref_code").innerHTML = '#' + clab_code.substr(0,3);
      document.getElementById("ref_text").value = cref_text;
      
      if (clab_text.charAt(0) === clab_text.charAt(0).toUpperCase()) {
        var lab2 = clab_text
      } else {
        var lab2 = clab_text.charAt(0).toUpperCase() + clab_text.substr(1,clab_text.length);
      }
      
      if (cref_text.charAt(0) === cref_text.charAt(0).toUpperCase()) {
        var ref2 = cref_text
      } else {
        var ref2 = cref_text.charAt(0).toUpperCase() + cref_text.substr(1,cref_text.length);
      }
      document.getElementById("lab_result").innerHTML = clab_text + ' 1';
      document.getElementById("lab_result2").innerHTML = lab2 + ' 1';
      document.getElementById("ref_result").innerHTML = cref_text + ' 1';
      document.getElementById("ref_result2").innerHTML = ref2 + ' 1';
      
      
      if (clab_bold === "true") {
        document.getElementById("lab_result").style.fontWeight = "bold";
        document.getElementById("lab_result2").style.fontWeight = "bold";
        $("#lab_bold").addClass("st-selected");
      } else {
        document.getElementById("lab_result").style.fontWeight = null;
        document.getElementById("lab_result2").style.fontWeight = null;
        $("#lab_bold").removeClass("st-selected");
      }
      if (clab_ital === "true") {
        document.getElementById("lab_result").style.fontStyle = "italic";
        document.getElementById("lab_result2").style.fontStyle = "italic";
        $("#lab_ital").addClass("st-selected");
      } else {
        document.getElementById("lab_result").style.fontStyle = null;
        document.getElementById("lab_result2").style.fontStyle = null;
        $("#lab_ital").removeClass("st-selected");
      }
      if (clab_unde === "true") {
        document.getElementById("lab_result").style.textDecoration = "underline";
        document.getElementById("lab_result2").style.textDecoration = "underline";
        $("#lab_unde").addClass("st-selected");
      } else {
        document.getElementById("lab_result").style.textDecoration = null;
        document.getElementById("lab_result2").style.textDecoration = null;
        $("#lab_unde").removeClass("st-selected");
      }
      if (cref_bold === "true") {
        document.getElementById("ref_result").style.fontWeight = "bold";
        document.getElementById("ref_result2").style.fontWeight = "bold";
        $("#ref_bold").addClass("st-selected");
      } else {
        document.getElementById("ref_result").style.fontWeight = null;
        document.getElementById("ref_result2").style.fontWeight = null;
        $("#ref_bold").removeClass("st-selected");
      }
      if (cref_ital === "true") {
        document.getElementById("ref_result").style.fontStyle = "italic";
        document.getElementById("ref_result2").style.fontStyle = "italic";
        $("#ref_ital").addClass("st-selected");
      } else {
        document.getElementById("ref_result").style.fontStyle = null;
        document.getElementById("ref_result2").style.fontStyle = null;
        $("#ref_ital").removeClass("st-selected");
      }
      if (cref_unde === "true") {
        document.getElementById("ref_result").style.textDecoration = "underline";
        document.getElementById("ref_result2").style.textDecoration = "underline";
        $("#ref_unde").addClass("st-selected");
      } else {
        document.getElementById("ref_result").style.textDecoration = null;
        document.getElementById("ref_result2").style.textDecoration = null;
        $("#ref_unde").removeClass("st-selected");
      }
    }
    
    
    $('#name').on('focusin', function(){
      $(this).data('val', $(this).val());
    });

    function updateTemp() {
    
      var prev_name = $('#name').data('val');
      var name = $('#name').val(); 
      var lab_code = document.getElementById("lab_code").innerHTML.substr(1,6);;
      var lab_text = $("#lab_text").val();
      var ref_text = $("#ref_text").val();

      if (document.getElementById("lab_result").style.fontWeight === "bold") {
        var lab_bold = "true"
      } else {
        var lab_bold = "null"
      }
      if (document.getElementById("lab_result").style.fontStyle === "italic") {
        var lab_ital = "true"
      } else {
        var lab_ital = "null"
      }
      if (document.getElementById("lab_result").style.textDecoration === "underline") {
        var lab_unde = "true"
      } else {
        var lab_unde = "null"
      }
      if (document.getElementById("ref_result").style.fontWeight === "bold") {
        var ref_bold = "true"
      } else {
        var ref_bold = "null"
      }
      if (document.getElementById("ref_result").style.fontStyle === "italic") {
        var ref_ital = "true"
      } else {
        var ref_ital = "null"
      }
      if (document.getElementById("ref_result").style.textDecoration === "underline") {
        var ref_unde = "true"
      } else {
        var ref_unde = "null"
      }
      
      temp_settings[prev_name] = [
        lab_code,
        prev_name,
        lab_text,
        lab_bold,
        lab_ital,
        lab_unde,
        ref_text,
        ref_bold,
        ref_ital,
        ref_unde
      ]
      
      $("#name").data('val', $('#name').val());
    }
    
    function storeDefault() {
    updateTemp();
    google.script.run.withSuccessHandler().storeDefault(temp_settings)
    }
    
    function restoreDefault(defaults) {
     $('#name')
    .find('option')
    .remove()
    .end();
    
     initialiseSidebar(defaults);
    }
    
    function selectName() {
      updateTemp();
      updateSidebar(document.getElementById('name').value);
    }
    
    document.getElementById("lab_text").onkeyup = function() {
      var lab = document.getElementById("lab_text").value;
      
      if (lab.charAt(0) === lab.charAt(0).toUpperCase()) {
        var lab2 = lab
      } else {
        var lab2 = lab.charAt(0).toUpperCase() + lab.substr(1,lab.length);
      }
      document.getElementById("lab_result").innerHTML = lab + '1';
      document.getElementById("lab_result2").innerHTML = lab2 + '1';
    } 
    
    document.getElementById("ref_text").onkeyup = function() {
      var ref = document.getElementById("ref_text").value;
      
      if (ref.charAt(0) === ref.charAt(0).toUpperCase()) {
        var ref2 = ref
      } else {
        var ref2 = ref.charAt(0).toUpperCase() + ref.substr(1,ref.length);
      }
      
      document.getElementById("ref_result").innerHTML = ref + '1';
      document.getElementById("ref_result2").innerHTML = ref2 + '1';
    }
    
    $(".style-button").on("click", function() {
      $(this).toggleClass("st-selected");
      var target = this.id.substr(0,3) + "_result";
      var target2 = this.id.substr(0,3) + "_result2";
      var attribute = this.id.substr(4,6);

      if (attribute === "bold") {
        if (document.getElementById(target).style.fontWeight === "bold") {
          document.getElementById(target).style.fontWeight = null;
          document.getElementById(target2).style.fontWeight = null;
          styles[this.id] = null;
        } else {
          document.getElementById(target).style.fontWeight = "bold";
          document.getElementById(target2).style.fontWeight = "bold";
          styles[this.id] = true;
        }
      }
      
      if (attribute === "ital") {
        if (document.getElementById(target).style.fontStyle === "italic") {
          document.getElementById(target).style.fontStyle = null;
          document.getElementById(target2).style.fontStyle = null;
          styles[this.id] = null;
        } else {
          document.getElementById(target).style.fontStyle = "italic";
          document.getElementById(target2).style.fontStyle = "italic";
          styles[this.id] = true;
        }
      }
      
      if (attribute === "unde") {
        if (document.getElementById(target).style.textDecoration === "underline") {
          document.getElementById(target).style.textDecoration = null;
          document.getElementById(target2).style.textDecoration = null;
          styles[this.id] = null;
        } else {
          document.getElementById(target).style.textDecoration = "underline";
          document.getElementById(target2).style.textDecoration = "underline";
          styles[this.id] = true;
        }
      }
    });
    
    function saveProperties() {
      document.getElementById("save").disabled = true;
      updateTemp();
      google.script.run.updateProps(temp_settings);
      setTimeout(function() {
        document.getElementById("save").disabled = false;
       }, 1000);
    }
    </script>
  </body>
</html>
