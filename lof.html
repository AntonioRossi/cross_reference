<script src='//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'>
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.10.81/pdf.js'>
</script>
  
<script>

PDFJS.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.10.81/pdf.worker.js'

$(function() {
  google.script.run.withSuccessHandler(logIt).getPDF();
});

var page_labs = [];

function logIt(blob) {
  
  var timer = 6000
  
  setTimeout(function() {
    google.script.run.withSuccessHandler(restoreLabels).lofNumbers(page_labs)
  }, timer)
  
  PDFJS.getDocument({data: blob}).then(function (PDFdoc) {
    var num_pages = PDFdoc.numPages
    for (var i=1; i<=num_pages; i++) {
    var array = [];
      PDFdoc.getPage(i).then(function (PDFpage) {
        var page_number = PDFpage.pageIndex + 1;
        var labs = page_number
        PDFpage.getTextContent().then(function (text) {
        var flat = JSON.stringify(text['items']);
        var lab_count = flat.split('☖☂').length - 1;
        page_labs.push(lab_count)
        })
      })
    }
  })
}

function restoreLabels() {
  google.script.run.restoreLabels();
}
</script>

</html>


