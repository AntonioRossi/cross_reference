<script src='//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'>
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.10.81/pdf.js'>
</script>
  
<script>

PDFJS.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.10.81/pdf.worker.js'

$(function() {
  google.script.run.withSuccessHandler(countFigures).getPDF();
});

var page_labs = [];

function logIt(blob) {
  var pdf = PDFJS.getDocument({data: blob});
  return pdf.then(function(pdf) {
    var maxPages = pdf.pdfInfo.numPages;
    var countPromises = []; // collecting all page promises
    for (var j = 1; j <= maxPages; j++) {
      var page = pdf.getPage(j);
      countPromises.push(page.then(function(page) { // add page promise
        var textContent = page.getTextContent();
        return textContent.then(function(page){ // return content promise;
          return textContent// value for page words
        });
      }));
    }
  
    // Wait for all pages and sum counts
  
    return Promise.all(countPromises).then(function (counts) {
      var final_count = [];
      for (var i=0; i<counts.length; i++) {
        var as_string = JSON.stringify(counts[i]);
        final_count.push(as_string.split('â˜™').length - 1)
      }
      return final_count;
    });
  });
}

function countFigures(blob) {
  logIt(blob).then(function (count) {
    google.script.run.withSuccessHandler(restoreLabels).lofNumbers(count);   
  });
}


function restoreLabels() {
  google.script.run.restoreLabels();
}
</script>
